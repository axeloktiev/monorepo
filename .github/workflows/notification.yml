name: Slack package version notification 2.1

on:
  registry_package:
    types: [published, updated]

jobs:
  notify:
    name: Notify slack
    runs-on: ubuntu-latest
    steps:

      - name: Send Slack notification
        uses: abinoda/slack-action@master
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
        with:
          args: '{\"channel\":\"${{ secrets.SLACK_CHANNEL_ID}}\",\"blocks\":[{\"type\":\"header\",\"text\":{\"type\":\"plain_text\",\"text\":\"New package published\"}},{\"type\":\"divider\"},{\"type\":\"context\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\":package: Name: @playsportsgroup\\/${{ github.event.registry_package.name }} \n\"},{\"type\":\"mrkdwn\",\"text\":\":commits_url\\/${{ github.event.package.package_version.package_files }},{\"type\":\"mrkdwn\",\"text\":\":rocket: Version: ${{ github.event.registry_package.package_version.version }}\"}]},{\"type\":\"actions\",\"block_id\":\"packageLink\",\"elements\":[{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Visit the package\"},\"style\":\"primary\",\"action_id\":\"button\",\"url\":\"${{ github.event.registry_package.html_url }}\"}]}]}'